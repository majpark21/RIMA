% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_nhoodnhood_significance.R
\name{calculate_nhoodnhood_significance}
\alias{calculate_nhoodnhood_significance}
\title{Calculate Neighbourhood-Neighbourhood Significance}
\usage{
calculate_nhoodnhood_significance(
  milos,
  dt_sims,
  n_scrambles,
  col_scramble_label = "false",
  assay = "logcounts",
  sim_method = "spearman",
  adjust = "holm",
  alpha_adjust = 0.05,
  direction = c("b", "lr", "rl")
)
}
\arguments{
\item{milos}{A list of 2 Milo objects. The \code{direction} determines which
object is kept intact  and which is scrambled to generate the null.}

\item{dt_sims}{A data.table with 3 columns as returned by \code{calculate_similarities()}.
The first 2 columns indicate neighbourhood pairs, the third column (named \code{"sim"})
contains similarity values between intact neighbourhoods.}

\item{n_scrambles}{Integer. Number of rounds of cell resampling to generate the null distribution.}

\item{col_scramble_label}{Character string specifying a column in the scrambled Milo's \code{colData}.
Label frequencies are estimated from this column to weight the sampling probability of each cell
during scrambling. Cells with common labels are less likely to be sampled. Use \code{"false"} for unweighted sampling.
Default is \code{"false"}.}

\item{assay}{Character string specifying the assay to use for calculating neighbourhood expression.
Default is \code{"logcounts"}.}

\item{sim_method}{Character string specifying the similarity metric.
Must be one of \code{"pearson"}, \code{"kendall"}, or \code{"spearman"}. Default is \code{"spearman"}.}

\item{adjust}{Character string specifying the method for p-value adjustment.
Must be a valid method in \code{p.adjust()}. If \code{NULL}, no adjustment is applied.
Default is \code{"holm"}.}

\item{alpha_adjust}{Numeric. Significance level for calling edges significant.
Float between 0 and 1. Default is 0.05.}

\item{direction}{Character string specifying the direction of testing.
Must be one of:
\describe{
  \item{\code{"lr"}}{Left-right: 1st Milo intact, 2nd scrambled.}
  \item{\code{"rl"}}{Right-left: 2nd Milo intact, 1st scrambled.}
  \item{\code{"b"}}{Bidirectional (default): tests both directions and combines p-values using Simes' method.}
}}
}
\value{
A data.table based on \code{dt_sims}, with additional columns:
  \item{pval}{Empirical p-value for each neighbourhood pair.}
  \item{pval_adjusted}{Adjusted p-value after multiple testing correction.}
  \item{is_significant}{Logical indicating whether the pair is significant at \code{alpha_adjust}.}
  (For bidirectional testing, also includes pval_lr, pval_rl, pval_combined, etc.)
}
\description{
Runs a pipeline to assign p-values to neighbourhood-neighbourhood edges
by comparing true neighbourhood-neighbourhood similarities against a null
distribution generated by cell identity scrambling and computing similarities
between true and scrambled neighbourhoods.
Optionally tests in both directions and combines p-values using Simes' method.
}
\details{
The function performs the following steps:
1. Scrambles neighbourhoods in one (or both) Milo object(s).
2. Generates a null distribution by calculateing similarities between original neighbourhoods and scrambled neighbourhoods.
3. Estimates empirical p-values by comparing true similarities to the null distribution.
4. Applies multiple testing correction.
5. If bidirectional, combines p-values from both directions using Simes' method.
}
\examples{
# Not run: dt_sims_sig <- calculate_nhoodnhood_significance(milos, dt_sims, n_scrambles = 10)
}
